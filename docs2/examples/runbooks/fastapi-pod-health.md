# FastAPI 파드 헬스체크 실패 런북

## Goal
FastAPI 기반 서비스의 파드가 비정상 상태(CrashLoopBackOff, 재시작 반복, 헬스체크 실패)일 때 원인을 분석합니다.

## Workflow

1. **파드 상태 확인**
   - 해당 서비스의 파드 목록과 상태를 조회합니다.
   - Restart 횟수가 비정상적으로 높은지 확인합니다.
   - 파드 이벤트에서 Liveness/Readiness Probe 실패 기록을 확인합니다.

2. **파드 로그 확인**
   - 현재 파드와 이전 컨테이너(--previous)의 로그를 조회합니다.
   - Traceback, Error, Exception 키워드를 검색합니다.
   - 애플리케이션 시작 실패 원인을 파악합니다.

3. **헬스체크 엔드포인트 직접 확인**
   - /health 또는 /healthz 엔드포인트에 HTTP 요청을 보냅니다.
   - 응답 코드와 본문을 확인합니다.
   - 응답 시간이 프로브 타임아웃을 초과하는지 확인합니다.

4. **리소스 및 설정 확인**
   - 파드의 리소스 요청/제한 설정을 확인합니다.
   - 환경변수와 ConfigMap/Secret 마운트 상태를 확인합니다.
   - 디플로이먼트의 프로브 설정(경로, 포트, 타임아웃)을 확인합니다.

5. **외부 의존성 확인**
   - 데이터베이스, Redis, 메시지 큐 등 외부 서비스 연결 상태를 확인합니다.
   - DNS 해석과 네트워크 접근이 정상인지 확인합니다.

## Synthesis
- 로그의 에러 패턴과 파드 이벤트를 종합하여 실패 원인을 특정합니다.
- 프로브 실패와 애플리케이션 에러의 인과 관계를 분석합니다.

## Remediation
- **시작 실패**: 환경변수, 설정 파일, 의존성 서비스 확인
- **프로브 타임아웃**: initialDelaySeconds 증가, 타임아웃 조정
- **OOM**: 메모리 제한 증가, 메모리 누수 조사
- **외부 의존성 실패**: 연결 정보 확인, 서킷 브레이커 설정 검토
